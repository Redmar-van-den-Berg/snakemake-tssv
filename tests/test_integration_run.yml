- name: integration-one-sample
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_single.yml
      --snakefile Snakefile
  stderr:
    must_not_contain:
      - rror
  files:
    - path: sample1/vcf/sample1_000.vcf
    - path: sample1/vcf/sample1_005.vcf
    - path: sample1/vcf/x000
      should_exist: false
    - path: sample1/vcf/sample1.vcf
      should_exist: false

    - path: sample1/library/000.lib
    - path: sample1/library/005.lib

    - path: sample1/tssv/005-forward/chrM:16023/newalleles.csv
      should_exist: false

- name: integration-output-folder
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_output_folder.yml
      --snakefile Snakefile
  stderr:
    must_not_contain:
      - rror
  files:
    - path: sample1/vcf/sample1_000.vcf
    - path: sample1/vcf/sample1_005.vcf
    - path: sample1/vcf/x000
      should_exist: false
    - path: sample1/vcf/sample1.vcf
      should_exist: false

    - path: sample1/library/000.lib
    - path: sample1/library/005.lib

    - path: sample1/tssv/005-forward/chrM:16023/newalleles.csv

- name: integration-two-samples
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_two.yml
      --snakefile Snakefile
  stderr:
    must_not_contain:
      - rror
  files:
    - path: sample1/vcf/sample1_000.vcf
    - path: sample1/vcf/sample1_001.vcf
    - path: sample1/vcf/sample1_005.vcf
      should_exist: false
    - path: sample1/vcf/x000
      should_exist: false
    - path: sample1/vcf/sample1.vcf
      should_exist: false
    - path: sample2/vcf/sample2_000.vcf
    - path: sample2/vcf/sample2_001.vcf
    - path: sample2/vcf/sample2_005.vcf
      should_exist: false
    - path: sample2/vcf/x000
      should_exist: false
    - path: sample2/vcf/sample2.vcf
      should_exist: false

    - path: sample1/library/000.lib
    - path: sample2/library/000.lib

- name: integration-all-options
  tags:
    - dry-run
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_all_options.yml
      --snakefile Snakefile
  exit_code: 0
  stderr:
    contains:
      - "--flank-size 27"
      - "--max-size 23"
    contains_regex:
      - "split.*--lines 11"
    must_not_contain:
      - rror
  stderr:
    must_not_contain:
      - rror
