- name: integration-one-sample
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_single.yml
      --snakefile Snakefile
  stderr:
    must_not_contain:
      - rror
  files:
    - path: split-vcf/000.vcf
    - path: split-vcf/005.vcf
    - path: split-vcf/x000
      should_exist: false

    - path: library/000.lib
    - path: library/005.lib

    - path: tssv/005-forward/chrM:16023/newalleles.csv
      should_exist: false

    - path: sample1/tssv/000-forward.txt
    - path: sample1/tssv/000-forward.json

    - path: sample1/tssv/000-reverse.txt
    - path: sample1/tssv/000-reverse.json

    - path: sample1/tssv/005-forward.txt
    - path: sample1/tssv/005-forward.json

    - path: sample1/tssv/005-reverse.txt
    - path: sample1/tssv/005-reverse.json

    - path: sample1/tssv/merged.json

    - path: final_report.csv

- name: integration-output-folder
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_output_folder.yml
      --snakefile Snakefile
  stderr:
    must_not_contain:
      - rror
  files:
    - path: split-vcf/000.vcf
    - path: split-vcf/005.vcf
    - path: split-vcf/x000
      should_exist: false

    - path: library/000.lib
    - path: library/005.lib

    - path: sample1/tssv/005-forward/chrM:16023/newalleles.csv

- name: integration-two-samples
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_two.yml
      --snakefile Snakefile
  stderr:
    must_not_contain:
      - rror
    must_not_contain_regex:
      - "python .*merge-tssv.py --files .*sample1.*sample2"
      - "python .*merge-tssv.py --files .*sample2.*sample1"
  files:
    - path: split-vcf/000.vcf
    - path: split-vcf/001.vcf
    - path: split-vcf/005.vcf
      should_exist: false
    - path: split-vcf/x000
      should_exist: false
    - path: split-vcf/000.vcf
    - path: split-vcf/001.vcf
    - path: split-vcf/005.vcf
      should_exist: false
    - path: vcf/x000
      should_exist: false

    - path: library/000.lib
    - path: library/000.lib

    - path: final_report.csv
      contains:
        - "Marker	Allele	sample1	sample2"
        - "chrM:8860	G	53	47"
        - "chrM:16023	G	32	28"
        - "chrM:16023	A	24	28"

- name: integration-all-options
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 120
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config_all_options.yml
      --snakefile Snakefile
  exit_code: 0
  stderr:
    contains:
      - "--flank-size 27"
      - "--max-size 23"
    contains_regex:
      - "split.*--lines 11"
    must_not_contain:
      - rror
  stderr:
    must_not_contain:
      - rror
